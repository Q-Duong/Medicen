const currentTime=JSON.parse(localStorage.getItem("currentTime"))||[],currentLocation=window.location.pathname;function getValues(){return[{name:"order_quantity_details",value:$(".order-quantity").val()},{name:"accountant_doctor_read",value:$(".accountant-doctor-read").val()},{name:"accountant_35X43",value:$(".accountant-35X43").val()},{name:"accountant_polime",value:$(".accountant-polime").val()},{name:"accountant_8X10",value:$(".accountant-8X10").val()},{name:"accountant_10X12",value:$(".accountant-10X12").val()},{name:"accountant_note",value:$(".accountant-note").val()},{name:"ord_delivery_date",value:$(".ord-delivery-date").val()},{name:"order_send_result",value:$(".order-send-result:checked").map((function(){return $(this).val()})).get()},{name:"ord_total_file_name",value:$("input[name=ord_total_file_name]").val()}]}function pushCurrentTime(e,t){var a={month:e,year:t};localStorage.setItem("currentTime",JSON.stringify(a))}function schedule(e){jQuery(document).ready((function(t){var a="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",n=t(".csstransitions").length>0;function o(e){this.element=e,this.timeline=this.element.find(".timeline"),this.timelineItems=this.timeline.find("li"),this.timelineItemsNumber=this.timelineItems.length,this.timelineStart=r(this.timelineItems.eq(0).text()),this.timelineUnitDuration=r(this.timelineItems.eq(1).text())-r(this.timelineItems.eq(0).text()),this.eventsWrapper=this.element.find(".events"),this.eventsGroup=this.eventsWrapper.find(".events-group"),this.singleEvents=this.eventsGroup.find(".single-event"),this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.modal=this.element.find(".event-modal"),this.modalHeader=this.modal.find(".header"),this.modalHeaderBg=this.modal.find(".header-bg"),this.modalBody=this.modal.find(".body"),this.modalBodyBg=this.modal.find(".body-bg"),this.modalMaxWidth=800,this.modalMaxHeight=640,this.animating=!1,this.initSchedule()}n||(a="noTransition"),o.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},o.prototype.scheduleReset=function(){var t=this.mq();"desktop"==t?(this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.element.addClass("js-full"),this.placeEvents(),this.element.hasClass("modal-is-open")&&this.checkEventModal(),30==e?this.eventsGroup.children("ul").css({height:"3000px"}):this.eventsGroup.children("ul").css({height:"3100px"})):"mobile"==t?(this.element.removeClass("js-full loading"),this.eventsGroup.children("ul").add(this.singleEvents).removeAttr("style"),this.eventsWrapper.children(".grid-line").remove(),this.element.hasClass("modal-is-open")&&this.checkEventModal()):"desktop"==t&&this.element.hasClass("modal-is-open")?(this.checkEventModal("desktop"),this.element.removeClass("loading")):this.element.removeClass("loading")},o.prototype.initEvents=function(){var e=this;this.singleEvents.each((function(){var a,n,o='<span class="event-date">Ngày chụp: '+(a=t(this).data("start"),(n=(a=a.replace(/ /g,"")).split("/"))[0]+"/"+n[1])+"</span>";t(this).children("a").prepend(t(o)),t(this).on("click","a",(function(a){a.preventDefault(),e.animating||e.openModal(t(this))}))})),this.modal.on("click",".close",(function(t){t.preventDefault(),e.animating||e.closeModal(e.eventsGroup.find(".selected-event"))})),this.element.on("click",".cover-layer",(function(t){!e.animating&&e.element.hasClass("modal-is-open")&&e.closeModal(e.eventsGroup.find(".selected-event"))}))},o.prototype.placeEvents=function(){var e=this,a=0;this.singleEvents.each((function(){var n=r(t(this).attr("data-start")),o=r(t(this).attr("data-start")),d=t(this).attr("data-child");1==d?t(this).css({left:"0px"}):2==d?t(this).css({left:"23px"}):t(this).css({right:"0px"}),a=n==o?60:o-n+60;var i=e.eventSlotHeight*(n-e.timelineStart)/e.timelineUnitDuration,l=e.eventSlotHeight*a/e.timelineUnitDuration;t(this).css({top:i-1+"px",height:l+1+"px"})})),this.element.removeClass("loading")},o.prototype.openModal=function(e){var o=this,d=o.mq();if(this.animating=!0,t("body").css("overflow","hidden"),this.modalHeader.find(".event-name-id").text(e.find(".event-name-id").text()),this.modalHeader.find(".event-name").text(e.find(".event-name").text()),this.modalHeader.find(".event-name-unit").text(e.find(".event-name-unit").text()),this.modalHeader.find(".event-date").text(e.find(".event-date").text()),this.modal.attr("data-event",e.parent().attr("data-event")),this.modalBody.find(".event-info").load(e.parent().attr("data-content")+".html .event-info > *",(function(e){o.element.addClass("content-loaded")})),this.modalBody.find(".event-car-id").html(e.find(".event-car-id").html()),this.modalBody.find(".event-id").html(e.find(".event-id").html()),this.modalBody.find(".event-unit").html(e.find(".event-unit").html()),this.modalBody.find(".event-cty-name").html(e.find(".event-cty-name").html()),this.modalBody.find(".event-address").html(e.find(".event-address").html()),this.modalBody.find(".event-note-content").html(e.find(".event-note").html()),this.modalBody.find(".event-select").html(e.find(".event-select").html()),this.modalBody.find(".event-list-file").html((function(){var a=e.find(".event-list-file-path").text(),n=e.find(".event-list-file").text();if(""!=a||0!=n){var o=a.split(","),d=n.split(","),i="";return Array.prototype.associate=function(e){var t={};return this.forEach((function(a,n){t[e[n]]=a})),t},t.each(o.associate(d),((e,t)=>{i+='<div class="main-file"><div class="file-content"><div class="file-name">'+e+'</div><div class="file-action"><a href="https://drive.google.com/file/d/'+t+'/view"target="_blank" class="download-file"><i class="far fa-eye"></i></a></div></div></div>'})),'<div class="section-file">'+i+"</div>"}return"Không có danh sách"})),this.modalBody.find(".event-info-contact").html(e.find(".event-info-contact").html()),this.modalBody.find(".event-time").html(e.find(".event-time").html()),this.modalBody.find(".event-quantity").html(e.find(".event-quantity").html()),this.modalBody.find(".event-doctor-read").html(e.find(".event-doctor-read").html()),this.modalBody.find(".event-film").html(e.find(".event-film").html()),this.modalBody.find(".event-form").html(e.find(".event-form").html()),this.modalBody.find(".event-print").html(e.find(".event-print").html()),this.modalBody.find(".event-form-print").html(e.find(".event-form-print").html()),this.modalBody.find(".event-print-result").html(e.find(".event-print-result").html()),this.modalBody.find(".event-film-sheet").html(e.find(".event-film-sheet").html()),this.modalBody.find(".event-order-note").html(e.find(".event-order-note").html()),this.modalBody.find(".event-ord-warning").html(e.find(".event-warning").html()),this.modalBody.find(".event-deadline").html(e.find(".event-deadline").html()),this.modalBody.find(".event-deliver-results").html(e.find(".event-deliver-results").html()),this.modalBody.find(".event-email").html(e.find(".event-email").html()),1==e.find(".event-status").html()?this.modalBody.find(".event-status").html('<span class="processing">Đang xử lý</span>'):2==e.find(".event-status").html()?this.modalBody.find(".event-status").html('<span class="updated">Đã cập nhật số Cas thực tế</span>'):4==e.find(".event-status").html()?this.modalBody.find(".event-status").html('<span class="update-acc">Đã cập nhật doanh thu</span>'):this.modalBody.find(".event-status").html('<span class="processed">Đã xử lý</span>'),this.modalBody.find(".event-draft").html(e.find(".event-quantity-draft").html()+" Cas"),this.modalBody.find(".event-noteKtv").html(e.find(".event-note-ktv").html()),this.modalBody.find(".order-quantity").val(e.find(".event-quantity").text()),""!=e.find(".event-quantity").text()?this.modalBody.find(".order-quantity").addClass("form-textbox-entered"):this.modalBody.find(".order-quantity").removeClass("form-textbox-entered"),this.modalBody.find(".accountant-doctor-read"),"Nhân"==e.find(".event-accountant-doctor-read").html()?this.modalBody.find(".doctor-N").prop("selected",!0):"Trung"==e.find(".event-accountant-doctor-read").html()?this.modalBody.find(".doctor-T").prop("selected",!0):"Giang"==e.find(".event-accountant-doctor-read").html()?this.modalBody.find(".doctor-G").prop("selected",!0):"Ân"==e.find(".event-accountant-doctor-read").html()?this.modalBody.find(".doctor-A").prop("selected",!0):this.modalBody.find(".doctor-empty").prop("selected",!0),this.modalBody.find(".accountant-35X43").val(e.find(".event-35X43").text()),""!=e.find(".event-35X43").text()?this.modalBody.find(".accountant-35X43").addClass("form-textbox-entered"):this.modalBody.find(".accountant-35X43").removeClass("form-textbox-entered"),this.modalBody.find(".accountant-polime").val(e.find(".event-polime").text()),""!=e.find(".event-polime").text()?this.modalBody.find(".accountant-polime").addClass("form-textbox-entered"):this.modalBody.find(".accountant-polime").removeClass("form-textbox-entered"),this.modalBody.find(".accountant-8X10").val(e.find(".event-8X10").text()),""!=e.find(".event-8X10").text()?this.modalBody.find(".accountant-8X10").addClass("form-textbox-entered"):this.modalBody.find(".accountant-8X10").removeClass("form-textbox-entered"),this.modalBody.find(".accountant-10X12").val(e.find(".event-10X12").text()),""!=e.find(".event-10X12").text()?this.modalBody.find(".accountant-10X12").addClass("form-textbox-entered"):this.modalBody.find(".accountant-10X12").removeClass("form-textbox-entered"),this.modalBody.find(".accountant-note").val(e.find(".event-accountant-note").text()),""!=e.find(".event-accountant-note").text()?this.modalBody.find(".accountant-note").addClass("form-textbox-entered"):this.modalBody.find(".accountant-note").removeClass("form-textbox-entered"),this.modalBody.find(".ord-delivery-date").val(e.find(".event-delivery-date").text()),""!=e.find(".event-delivery-date").text()?this.modalBody.find(".ord-delivery-date").addClass("form-textbox-entered"):this.modalBody.find(".ord-delivery-date").removeClass("form-textbox-entered"),this.modalBody.find(".block-order-send-result").html((function(){var a=e.find(".event-order-send-result").text();if(""!=a){var n=a.split(","),o="";return t.each(n,(function(e,t){"Gmail"==t&&1===n.length?o='<div class="form-checkbox"><input type="checkbox" id="result-Gmail" name="order_send_result" class="form-checkbox-input order-send-result" value="Gmail" checked><label for="result-Gmail" class="form-label">Gmail</label></div><div class="form-checkbox"><input type="checkbox" id="result-Zalo" name="order_send_result" class="form-checkbox-input order-send-result" value="Zalo"><label for="result-Zalo" class="form-label">Zalo</label></div>':"Zalo"==t&&1===n.length?o='<div class="form-checkbox"><input type="checkbox" id="result-Gmail" name="order_send_result" class="form-checkbox-input order-send-result" value="Gmail"><label for="result-Gmail" class="form-label">Gmail</label></div><div class="form-checkbox"><input type="checkbox" id="result-Zalo" name="order_send_result" class="form-checkbox-input order-send-result" value="Zalo" checked><label for="result-Zalo" class="form-label">Zalo</label></div>':o+='<div class="form-checkbox"><input type="checkbox" id="result-'+t+'" name="order_send_result" class="form-checkbox-input order-send-result" value="'+t+'" checked><label for="result-'+t+'" class="form-label">'+t+"</label></div>"})),o}return'<div class="form-checkbox"><input type="checkbox" id="result-Gmail" name="order_send_result" class="form-checkbox-input order-send-result" value="Gmail"><label for="result-Gmail" class="form-label">Gmail</label></div><div class="form-checkbox"><input type="checkbox" id="result-Zalo" name="order_send_result" class="form-checkbox-input order-send-result" value="Zalo"><label for="result-Zalo" class="form-label">Zalo</label></div>'})),3==e.find(".event-status").text()){this.modalBody.find(".order-quantity").attr("disabled",!0),this.modalBody.find(".accountant-doctor-read").attr("disabled",!0),this.modalBody.find(".accountant-35X43").attr("disabled",!0),this.modalBody.find(".accountant-polime").attr("disabled",!0),this.modalBody.find(".accountant-8X10").attr("disabled",!0),this.modalBody.find(".accountant-10X12").attr("disabled",!0),this.modalBody.find(".accountant-note").attr("disabled",!0),this.modalBody.find(".ord-delivery-date").attr("disabled",!0),this.modalBody.find(".order-send-result").attr("disabled",!0);var i=e.find(".event-total-file-path").text(),l=e.find(".event-total-file").text();this.modalBody.find(".total-file").addClass("hidden"),""!=i||""!=l?this.modalBody.find(".event-total-file").html((function(){var t=e.find(".event-details-id").html();return'<div class="section-file">'+('<input type="hidden" name="path" value="'+i+'"><input type="hidden" name="file" value="'+l+'"><input type="hidden" name="id" value="'+t+'"><div class="main-file"><div class="file-content"><div class="file-name">'+l+'</div><div class="file-action"><a href="https://drive.google.com/file/d/'+i+'/view"target="_blank" class="download-file"><i class="far fa-eye"></i></a></div></div></div>')+"</div>"})):this.modalBody.find(".event-total-file").html(""),this.modalBody.find(".submit-quantity-details").attr("disabled",!0).addClass("hidden")}else{this.modalBody.find(".order-quantity").attr("disabled",!1),this.modalBody.find(".accountant-doctor-read").attr("disabled",!1),this.modalBody.find(".accountant-35X43").attr("disabled",!1),this.modalBody.find(".accountant-polime").attr("disabled",!1),this.modalBody.find(".accountant-8X10").attr("disabled",!1),this.modalBody.find(".accountant-10X12").attr("disabled",!1),this.modalBody.find(".accountant-note").attr("disabled",!1),this.modalBody.find(".ord-delivery-date").attr("disabled",!1),this.modalBody.find(".order-send-result").attr("disabled",!1);i=e.find(".event-total-file-path").text(),l=e.find(".event-total-file").text();""!=i||""!=l?(this.modalBody.find(".total-file").addClass("hidden"),this.modalBody.find(".event-total-file").html((function(){var t=e.find(".event-details-id").html();return'<div class="section-file">'+('<input type="hidden" name="path" value="'+i+'"><input type="hidden" name="file" value="'+l+'"><input type="hidden" name="id" value="'+t+'"><div class="main-file"><div class="file-content"><div class="file-name">'+l+'</div><div class="file-action"><a href="https://drive.google.com/file/d/'+i+'/view"target="_blank" class="download-file"><i class="far fa-eye"></i></a><button class="delete-file del-total-file" type="button"><i class="fas fa-times"></i></button></div></div></div>')+"</div>"}))):(this.modalBody.find(".total-file").removeClass("hidden"),this.modalBody.find(".event-total-file").html("")),this.modalBody.find(".submit-quantity-details").attr("disabled",!1).removeClass("hidden")}if(this.element.addClass("modal-is-open"),setTimeout((function(){e.parent("li").addClass("selected-event")}),10),"mobile"==d)o.modal.one(a,(function(){o.modal.off(a),o.animating=!1}));else{var s=e.offset().top-t(window).scrollTop(),r=e.offset().left,m=t(window).width(),h=t(window).height(),f=.8*m>o.modalMaxWidth?o.modalMaxWidth:.8*m,u=.8*h>o.modalMaxHeight?o.modalMaxHeight:.8*h,v=parseInt((m-f)/2-r),p=parseInt((h-u)/2-s);o.modal.css({top:s+"px",left:r+"px",height:u+"px",width:f+"px"}),c(o.modal,"translateY("+p+"px) translateX("+v+"px)"),o.modalHeaderBg.one(a,(function(){o.modalHeaderBg.off(a),o.animating=!1,o.element.addClass("animation-completed")}))}n||o.modal.add(o.modalHeaderBg).trigger(a)},o.prototype.closeModal=function(e){var o=this,d=o.mq();if(this.animating=!0,t("body").removeAttr("style"),"mobile"==d)this.element.removeClass("modal-is-open"),this.modal.one(a,(function(){o.modal.off(a),o.animating=!1,o.element.removeClass("content-loaded"),e.removeClass("selected-event")}));else{var i=e.offset().top-t(window).scrollTop(),l=e.offset().left,s=e.innerHeight(),r=e.innerWidth(),m=Number(o.modal.css("top").replace("px","")),h=l-Number(o.modal.css("left").replace("px","")),f=i-m;o.element.removeClass("animation-completed modal-is-open"),this.modal.css({width:r+"px",height:s+"px"}),c(o.modal,"translateX("+h+"px) translateY("+f+"px)"),c(o.modalBodyBg,"scaleX(0) scaleY(1)"),c(o.modalHeaderBg,"scaleY(1)"),this.modalHeaderBg.one(a,(function(){o.modalHeaderBg.off(a),o.modal.addClass("no-transition"),setTimeout((function(){o.modal.add(o.modalHeader).add(o.modalBody).add(o.modalHeaderBg).add(o.modalBodyBg).attr("style","")}),10),setTimeout((function(){o.modal.removeClass("no-transition")}),20),o.animating=!1,o.element.removeClass("content-loaded"),e.removeClass("selected-event")}))}n||o.modal.add(o.modalHeaderBg).trigger(a)},o.prototype.mq=function(){return window.getComputedStyle(this.element.get(0),"::before").getPropertyValue("content").replace(/["']/g,"")},o.prototype.checkEventModal=function(e){this.animating=!0;var a=this,n=this.mq();if("mobile"==n)a.modal.add(a.modalHeader).add(a.modalHeaderBg).add(a.modalBody).add(a.modalBodyBg).attr("style",""),a.modal.removeClass("no-transition"),a.animating=!1;else if("desktop"==n&&a.element.hasClass("modal-is-open")){a.modal.addClass("no-transition"),a.element.addClass("animation-completed");var o=a.eventsGroup.find(".selected-event"),d=(o.offset().top,t(window).scrollTop(),o.offset().left,o.innerHeight(),o.innerWidth(),t(window).width()),i=t(window).height(),l=.8*d>a.modalMaxWidth?a.modalMaxWidth:.8*d,s=.8*i>a.modalMaxHeight?a.modalMaxHeight:.8*i;setTimeout((function(){a.modal.css({width:l+"px",height:s+"px",top:i/2-s/2+"px",left:d/2-l/2+"px"}),c(a.modal,"translateY(0) translateX(0)")}),10),setTimeout((function(){a.modal.removeClass("no-transition"),a.animating=!1}),20)}};var d=t(".cd-schedule"),i=[],l=!1;function s(){i.forEach((function(e){e.scheduleReset()})),l=!1}function r(e){var t=(e=e.replace(/ /g,"")).split("/");return 60*parseInt(t[0])}function c(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}d.length>0&&d.each((function(){i.push(new o(t(this)))})),t(window).on("resize",(function(){l||(l=!0,window.requestAnimationFrame?window.requestAnimationFrame(s):setTimeout(s))})),t(window).keyup((function(e){27==e.keyCode&&i.forEach((function(e){e.closeModal(e.eventsGroup.find(".selected-event"))}))}))}))}$.ajax({url:url_get_schedule,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),currentTime:currentTime},success:function(e){$(".schedule-render").html(e.html),schedule(e.day)}}),$(document).on("change",".select-month",(function(){var e=$(this).val(),t=$(".select-year").val();$(".schedule-search").removeClass("search-show").val(""),$(".btn-search").html('<button class="btn-schedule-search"><i class="fas fa-search"></i></button>'),$(".search-results").removeClass("search-results-show").html(""),$(".loader-over").fadeIn(),$.ajax({url:url_select_details,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),year:t,month:e},success:function(a){pushCurrentTime(e,t),schedule(a.day),$(".schedule").html(a.html),$(".loader-over").fadeOut()},error:function(e){popupNotificationSessionExpired()},complete:function(){$(".loader-over").fadeOut()}})})),$(document).on("click",".btn-schedule-search",(function(){$("input[name=search-keywords]").focus(),$(".schedule-search").addClass("search-show"),$(".btn-search").html('<button class="btn-close-search"><i class="fas fa-times"></i></button>'),$(".search-results").addClass("search-results-show")})),$(document).on("click",".btn-close-search",(function(){var e=$(".select-month").val(),t=$(".select-year").val();$(".schedule-search").removeClass("search-show").val(""),$(".btn-search").html('<button class="btn-schedule-search"><i class="fas fa-search"></i></button>'),$(".search-results").removeClass("search-results-show").html(""),$(".loader-over").fadeIn(),$.ajax({url:url_select_details,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),year:t,month:e},success:function(e){schedule(e.day),$(".schedule").html(e.html),$(".loader-over").fadeOut()},error:function(e){popupNotificationSessionExpired()},complete:function(){$(".loader-over").fadeOut()}})})),$(document).on("keyup",".schedule-search",(function(){var e=$(this).val(),t=JSON.parse(localStorage.getItem("currentTime"))||[];""!=e?$.ajax({url:url_search_suggest,method:"POST",data:{currentTime:t,query:e,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){$(".search-results").addClass("search-results-show").html(e.html)},error:function(e){popupNotificationSessionExpired()},complete:function(){$(".loader-over").fadeOut()}}):$(".search-results").removeClass("search-results-show").html("")})),$(document).on("click",".li_search",(function(){var e=$(this).text(),t=JSON.parse(localStorage.getItem("currentTime"))||[];$(".loader-over").fadeIn(),$(".search-results").removeClass("search-results-show").html(""),$(".schedule-search").val(e),$.ajax({url:url_schedule_search,method:"POST",data:{currentTime:t,param:e,_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){schedule(e.day),$(".schedule").html(e.html),$(".loader-over").fadeOut()},error:function(e){popupNotificationSessionExpired()},complete:function(){$(".loader-over").fadeOut()}})})),$(document).on("change",".select-year",(function(){$(".define-month").prop("selected",!0)})),$(document).on("click",".submit-quantity-details",(function(){var e=getValues();e.push({name:"id",value:$(".event-info").find(".event-id").text()},{name:"_token",value:$('meta[name="csrf-token"]').attr("content")}),$(".loader-over").fadeIn(),$.ajax({url:url_update_details,method:"POST",data:e,success:function(){$(".event-modal").fadeOut(),$(".cover-layer").css({opacity:"0"}),$(".loader-over").fadeOut(),successMsg("Bạn đã cập nhật số Cas chụp thành công"),setTimeout((function(){location.reload()}),1e3)},error:function(e){popupNotificationSessionExpired()},complete:function(){$(".event-modal").fadeOut(),$(".cover-layer").css({opacity:"0"}),$(".loader-over").fadeOut()}})}));